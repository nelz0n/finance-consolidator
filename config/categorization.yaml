# Categorization Configuration
# 3-Tier Category System with Manual Rules, Internal Transfer Detection, and AI Fallback

# ============================================================================
# INTERNAL TRANSFER DETECTION
# ============================================================================
internal_transfers:
  # List all your own account numbers
  own_accounts:
    - "283337817/0300"  # ČSOB Credit Card - Spolocne
    - "210621040/0300"  # ČSOB Main - Brano
    - "243160770/0300"  # ČSOB - Mirka
    - "3581422554/6363" # Partners Bank
    - "1330299329/6363" # Partners Bank
    - "2106210400/6363" # Partners Bank

  # Exclusions: Do NOT mark as internal transfer if any of these conditions match
  exclusions:
    # Exclude specific counterparty names (e.g., platform rewards, bank-generated transactions)
    counterparty_names:
      - "TransferWise"  # Wise cashback/rewards
      - "Wise"
      - "Amazon"  # Amazon refunds

    # Exclude specific transaction types (e.g., interest is income, not transfer)
    transaction_types:
      - "Úroky"  # Interest (Partners Bank)
      - "Daň z úroku"  # Interest tax (Partners Bank)

  # Detection methods (applied in order)
  detection_methods:
    # Method 1: Counterparty account in own accounts
    - type: "counterparty_in_own_accounts"
      enabled: true

    # Method 2: Description keywords
    - type: "description_keywords"
      enabled: false
      keywords:
        - "PŘEVOD"
        - "PREVOD"
        - "TRANSFER"
        - "INTERNAL"
        - "MEZI ÚČTY"
        - "MEZI UCTY"

  # Category for detected internal transfers
  category:
    tier1: "Presuny (Neutrálne)"
    tier2: "Interné presuny"
    tier3: "Medzi vlastnými účtami"

  # Exclude from expense reports
  exclude_from_expenses: true

# ============================================================================
# 3-TIER CATEGORY TREE
# Slovak language categories for household budgeting
# ============================================================================
# ============================================================================
# AI FALLBACK CONFIGURATION (Gemini Flash)
# ============================================================================
ai_fallback:
  enabled: true  # Enabled by default (use --disable-ai to turn off)
  provider: "gemini"
  model: "gemini-2.5-flash-lite"

  # API Configuration
  api_key_env: "GEMINI_API_KEY"  # Read from environment variable
  api_url: "https://generativelanguage.googleapis.com/v1beta"

  # Behavior
  confidence_threshold: 75  # Only accept if AI is >75% confident

  # Rate limiting (Gemini free tier: 15 req/min, 1500/day)
  rate_limit:
    requests_per_minute: 15  # Conservative
    requests_per_day: 1500

  # Retry configuration for failed API calls
  max_retries: 3  # Number of retry attempts for failed calls
  retry_base_delay: 2  # Base delay in seconds (exponential backoff: 2s, 4s, 8s)

  # Prompt template
  prompt_template: |
    You are a financial transaction categorizer for Czech household expenses.

    CRITICAL INSTRUCTIONS:
    1. You MUST select categories from the 3-tier hierarchy below EXACTLY as shown
    2. Tier1 is the TOP LEVEL category (first column)
    3. Tier2 is the SECOND LEVEL category (indented with "-")
    4. Tier3 is the THIRD LEVEL category (listed after ":")
    5. Do NOT use a Tier2 name as Tier1 - check the hierarchy carefully!
    6. Do NOT invent categories or modify names

    Transaction details:
    - Date: {date}
    - Amount: {amount} {currency}
    - Type: {transaction_type}
    - Description: {description}
    - Counterparty: {counterparty_name}
    - Counterparty Account: {counterparty_account}

    3-TIER CATEGORY HIERARCHY (Tier1 > Tier2 > Tier3):
    {category_tree_summary}

    EXAMPLES OF CORRECT FORMAT:
    - For interest income: Tier1="Prijmy", Tier2="Investicie", Tier3="Uroky"
    - For salary: Tier1="Prijmy", Tier2="Zamestnanie", Tier3="Plat"
    - NOT VALID: Tier1="Investicie" (Investicie is a Tier2 category!)

    Respond ONLY in this exact format:
    Tier1: [exact tier1 name from first column above]
    Tier2: [exact tier2 name from indented "-" section]
    Tier3: [exact tier3 name from list after ":")
    Confidence: [0-100]
    Reasoning: [brief explanation]

    Be conservative - if unsure, use "Uncategorized" > "Needs Review" > "Unknown Transaction" with low confidence.

