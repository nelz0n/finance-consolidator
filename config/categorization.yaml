# Categorization Configuration
# 3-Tier Category System with Manual Rules, Internal Transfer Detection, and AI Fallback

# ============================================================================
# INTERNAL TRANSFER DETECTION
# ============================================================================
internal_transfers:
  # List all your own account numbers
  own_accounts:
    - "283337817/0300"  # ČSOB Credit Card - Spolocne
    - "210621040/0300"  # ČSOB Main - Brano
    - "243160770/0300"  # ČSOB - Mirka
    - "3581422554/6363" # Partners Bank
    - "1330299329/6363" # Partners Bank
    - "2106210400/6363" # Partners Bank

  # Exclusions: Do NOT mark as internal transfer if any of these conditions match
  exclusions:
    # Exclude specific counterparty names (e.g., platform rewards, bank-generated transactions)
    counterparty_names:
      - "TransferWise"  # Wise cashback/rewards
      - "Wise"
      - "Amazon"  # Amazon refunds

    # Exclude specific transaction types (e.g., interest is income, not transfer)
    transaction_types:
      - "Úroky"  # Interest (Partners Bank)
      - "Daň z úroku"  # Interest tax (Partners Bank)

  # Detection methods (applied in order)
  detection_methods:
    # Method 1: Counterparty account in own accounts
    - type: "counterparty_in_own_accounts"
      enabled: true

    # Method 2: Description keywords
    - type: "description_keywords"
      enabled: false
      keywords:
        - "PŘEVOD"
        - "PREVOD"
        - "TRANSFER"
        - "INTERNAL"
        - "MEZI ÚČTY"
        - "MEZI UCTY"

    # Method 3: Same-day opposite amount (advanced)
    - type: "same_day_opposite_amount"
      enabled: true
      tolerance_czk: 1.0  # Allow 1 CZK difference
      time_window_hours: 24

  # Category for detected internal transfers
  category:
    tier1: "Presuny (Neutrálne)"
    tier2: "Interné presuny"
    tier3: "Medzi vlastnými účtami"

  # Exclude from expense reports
  exclude_from_expenses: true

# ============================================================================
# 3-TIER CATEGORY TREE
# Slovak language categories for household budgeting
# ============================================================================
# ============================================================================
# AI FALLBACK CONFIGURATION (Gemini Flash)
# ============================================================================
ai_fallback:
  enabled: true
  provider: "gemini"
  model: "gemini-2.0-flash-exp"

  # API Configuration
  api_key_env: "GEMINI_API_KEY"  # Read from environment variable
  api_url: "https://generativelanguage.googleapis.com/v1beta"

  # Behavior
  confidence_threshold: 75  # Only accept if AI is >75% confident
  cache_results: true
  cache_file: "data/cache/ai_category_cache.json"

  # Rate limiting (Gemini free tier: 15 req/min, 1500/day)
  rate_limit:
    requests_per_minute: 10  # Conservative
    requests_per_day: 1000

  # Prompt template
  prompt_template: |
    You are a financial transaction categorizer for Czech household expenses.

    Categorize this transaction into exactly 3 tiers from the provided category tree.

    Transaction details:
    - Date: {date}
    - Amount: {amount} {currency}
    - Description: {description}
    - Counterparty: {counterparty_name}
    - Counterparty Account: {counterparty_account}

    Available categories (use EXACTLY these, do not invent new ones):
    {category_tree_summary}

    Respond ONLY in this exact format:
    Tier1: [exact tier1 name]
    Tier2: [exact tier2 name]
    Tier3: [exact tier3 name]
    Confidence: [0-100]
    Reasoning: [brief explanation]

    Be conservative - if unsure, use "Uncategorized" > "Needs Review" > "Unknown Transaction" with low confidence.

