# Categorization Configuration
# 3-Tier Category System with Manual Rules, Internal Transfer Detection, and AI Fallback

# ============================================================================
# INTERNAL TRANSFER DETECTION
# ============================================================================
internal_transfers:
  # List all your own account numbers
  own_accounts:
    - "283337817/0300"  # ČSOB Credit Card - Spolocne
    - "210621040/0300"  # ČSOB Main - Brano
    - "243160770/0300"  # ČSOB - Mirka
    - "3581422554/6363" # Partners Bank
    - "1330299329/6363" # Partners Bank
    - "2106210400/6363" # Partners Bank

  # Exclusions: Do NOT mark as internal transfer if any of these conditions match
  exclusions:
    # Exclude specific counterparty names (e.g., platform rewards, bank-generated transactions)
    counterparty_names:
      - "TransferWise"  # Wise cashback/rewards
      - "Wise"
      - "Amazon"  # Amazon refunds

    # Exclude specific transaction types (e.g., interest is income, not transfer)
    transaction_types:
      - "Úroky"  # Interest (Partners Bank)
      - "Daň z úroku"  # Interest tax (Partners Bank)

  # Detection methods (applied in order)
  detection_methods:
    # Method 1: Counterparty account in own accounts
    - type: "counterparty_in_own_accounts"
      enabled: true

    # Method 2: Description keywords
    - type: "description_keywords"
      enabled: false
      keywords:
        - "PŘEVOD"
        - "PREVOD"
        - "TRANSFER"
        - "INTERNAL"
        - "MEZI ÚČTY"
        - "MEZI UCTY"

    # Method 3: Same-day opposite amount (advanced)
    - type: "same_day_opposite_amount"
      enabled: true
      tolerance_czk: 1.0  # Allow 1 CZK difference
      time_window_hours: 24

  # Category for detected internal transfers
  category:
    tier1: "Presuny (Neutrálne)"
    tier2: "Interné presuny"
    tier3: "Medzi vlastnými účtami"

  # Exclude from expense reports
  exclude_from_expenses: true

# ============================================================================
# 3-TIER CATEGORY TREE
# Slovak language categories for household budgeting
# ============================================================================
category_tree:
  # TIER 1: Príjmy (Income)
  - tier1: "Príjmy"
    tier2_categories:
      - tier2: "Zamestnanie"
        tier3:
          - "Mzda"
          - "Bonusy"

      - tier2: "Podnikanie"
        tier3:
          - "Fakturácia(Príjem)"

      - tier2: "Prenájom"
        tier3:
          - "Nájomné (Príjem)"

      - tier2: "Investície"
        tier3:
          - "Dividendy"
          - "Úroky"
          - "Predaj aktív (Zisk)"

      - tier2: "Ostatné príjmy"
        tier3:
          - "Dary (Prijaté)"
          - "Cashback"
          - "Vratka dane"
          - "Predaj vecí"
          - "Rôzne"

  # TIER 1: Spotreba Rodina (Family Consumption)
  - tier1: "Spotreba Rodina"
    tier2_categories:
      - tier2: "Bývanie"
        tier3:
          - "Hypotéka / Nájom"
          - "Poistenie domácnosti"
          - "Údržba a opravy (doma)"
          - "Nábytok"
          - "Vybavenie"

      - tier2: "Energie a Služby"
        tier3:
          - "Elektrina"
          - "Poplatky (Bývanie)"
          - "Internet"
          - "Telefón"
          - "Subscriptions"

      - tier2: "Jedlo"
        tier3:
          - "Supermarket"
          - "Drogéria"
          - "Trhy / Lokálne potraviny"
          - "Reštaurácie"
          - "Kaviarne"
          - "Donáška jedla"
          - "Obedy v práci"

      - tier2: "Doprava (Osobná)"
        tier3:
          - "PHM (Osobné auto)"
          - "Poistenie auta"
          - "Servis a Údržba auta"
          - "Diaľničná známka"
          - "Parkovanie"
          - "MHD"
          - "Taxi"
          - "Leasing"

      - tier2: "Deti (Oliver & Alex)"
        tier3:
          - "Škola / Škôlka (Poplatky)"
          - "Školské obedy"
          - "Opatrovanie"
          - "Krúžky"
          - "Tábory"
          - "Školské potreby"
          - "Oblečenie (Deti)"
          - "Hračky a Knihy"
          - "Vreckové"

      - tier2: "Zdravie a Starostlivosť"
        tier3:
          - "Lekár / Poplatky"
          - "Zubár"
          - "Lekáreň / Vitamíny"
          - "Optika"
          - "Kaderník / Holič"
          - "Kozmetika"

      - tier2: "Osobná útrata"
        tier3:
          - "Oblečenie (Dospelí)"
          - "Obuv (Dospelí)"
          - "Fitnes / Šport"
          - "Koníčky"
          - "Kultúra (Kino, Divadlo)"
          - "Knihy / Tlač"
          - "Aplikácie a Hry"

      - tier2: "Dovolenka a Cestovanie"
        tier3:
          - "Ubytovanie"
          - "Letenky / Doprava"
          - "Cestovné poistenie"
          - "Jedlo (Dovolenka)"
          - "Aktivity (Dovolenka)"

      - tier2: "Ostatné (Rodina)"
        tier3:
          - "Dary (ktoré dávame)"
          - "Životné poistenie"
          - "Bankové poplatky (osobné)"
          - "Charita"
          - "Domáci miláčikovia"
          - "Rôzne"

  # TIER 1: Podnikanie (IČO) (Business)
  - tier1: "Podnikanie"
    tier2_categories:
      - tier2: "Odvody a Dane (IČO)"
        tier3:
          - "Sociálne poistenie"
          - "Zdravotné poistenie"
          - "Daň z príjmu (Zálohy)"
          - "Paušalna daň"

      - tier2: "Prevádzka (IČO)"
        tier3:
          - "Účtovníctvo"
          - "Náklady"

      - tier2: "Cestovné a Repre (IČO)"
        tier3:
          - "PHM (Firemné)"
          - "Ubytovanie (Firemné)"
          - "Diéty"

  # TIER 1: Prenájom (Náklady) (Rental Costs)
  - tier1: "Prenájom (Náklady)"
    tier2_categories:
      - tier2: "Náklady na Byt"
        tier3:
          - "Hypotéka (prenájom)"
          - "Fond opráv / SVJ (prenájom)"
          - "Platby správcovi / Energie"
          - "Poistenie nehnuteľnosti"
          - "Daň z nehnuteľnosti"
          - "Daň z prenájmu"

      - tier2: "Údržba Bytu"
        tier3:
          - "Opravy a Údržba"
          - "Nákup vybavenia (do prenájmu)"

  # TIER 1: Investície a Sporenie (Investments and Savings)
  - tier1: "Investície a Sporenie"
    tier2_categories:
      - tier2: "Investície (Nákup)"
        tier3:
          - "Akcie"
          - "ETF / Fondy"
          - "Kryptomeny"
          - "Dôchodkové sporenie"

      - tier2: "Sporenie (Vklady)"
        tier3:
          - "Sporiaci účet (Vklad)"
          - "Stavebné sporenie (Vklad)"

  # TIER 1: Presuny (Neutrálne) (Neutral Transfers)
  - tier1: "Presuny (Neutrálne)"
    tier2_categories:
      - tier2: "Interné presuny"
        tier3:
          - "Medzi vlastnými účtami"
          - "Výber z bankomatu"
          - "Vklad hotovosti"

      - tier2: "Splátky dlhov"
        tier3:
          - "Splátka Kreditnej Karty"
          - "Splátka Úveru / Pôžičky"
          - "Splátka Auta (Leasing/Úver)"

  # TIER 1: Nezaradené (Uncategorized)
  - tier1: "Uncategorized"
    tier2_categories:
      - tier2: "Needs Review"
        tier3:
          - "Unknown Transaction"

# ============================================================================
# AI FALLBACK CONFIGURATION (Gemini Flash)
# ============================================================================
ai_fallback:
  enabled: true
  provider: "gemini"
  model: "gemini-1.5-flash"

  # API Configuration
  api_key_env: "GEMINI_API_KEY"  # Read from environment variable
  api_url: "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent"

  # Behavior
  confidence_threshold: 75  # Only accept if AI is >75% confident
  cache_results: true
  cache_file: "data/cache/ai_category_cache.json"

  # Rate limiting (Gemini free tier: 15 req/min, 1500/day)
  rate_limit:
    requests_per_minute: 10  # Conservative
    requests_per_day: 1000

  # Prompt template
  prompt_template: |
    You are a financial transaction categorizer for Czech household expenses.

    Categorize this transaction into exactly 3 tiers from the provided category tree.

    Transaction details:
    - Date: {date}
    - Amount: {amount} {currency}
    - Description: {description}
    - Counterparty: {counterparty_name}
    - Counterparty Account: {counterparty_account}

    Available categories (use EXACTLY these, do not invent new ones):
    {category_tree_summary}

    Respond ONLY in this exact format:
    Tier1: [exact tier1 name]
    Tier2: [exact tier2 name]
    Tier3: [exact tier3 name]
    Confidence: [0-100]
    Reasoning: [brief explanation]

    Be conservative - if unsure, use "Uncategorized" > "Needs Review" > "Unknown Transaction" with low confidence.

# ============================================================================
# LEARNING SYSTEM (Build patterns over time)
# ============================================================================
learning:
  enabled: true

  # After N transactions with same pattern, auto-create rule
  pattern_threshold: 3

  # Patterns to learn
  learn_from:
    - ai_categorizations
    - manual_corrections

  # Auto-generated rules file
  learned_rules_file: "data/cache/learned_rules.yaml"
